<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>App-Fitness</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#111827" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- HOME -->
  <div id="home" class="screen active">

    <!-- TOP BAR (NOVO) -->
    <div class="home-topbar">
      <div></div>
      <button id="more-btn" class="more-btn" aria-label="Mais op√ß√µes">‚ãØ</button>
    </div>

    <h1 class="home-title">Minha App de Fitness</h1>
    <p class="home-subtitle">Escolha uma op√ß√£o</p>

    <div class="home-grid">
      <div class="home-card" data-screen="screen1" role="button" tabindex="0" aria-label="Abrir Plano de Treino">
        <div class="home-icon bg-blue" aria-hidden="true">üèãÔ∏è</div>
        <div class="home-card-title">Plano de Treino</div>
        <div class="home-card-desc">Organize seus exerc√≠cios por dia e acompanhe seu progresso</div>
      </div>

      <div class="home-card" data-screen="screen2" role="button" tabindex="0" aria-label="Abrir Plano Alimentar">
        <div class="home-icon bg-green" aria-hidden="true">üçΩÔ∏è</div>
        <div class="home-card-title">Plano Alimentar</div>
        <div class="home-card-desc">Planeje suas refei√ß√µes di√°rias com fotos e notas</div>
      </div>

      <div class="home-card" data-screen="screen3" role="button" tabindex="0" aria-label="Abrir Progresso">
        <div class="home-icon bg-purple" aria-hidden="true">üìà</div>
        <div class="home-card-title">Progresso</div>
        <div class="home-card-desc">Acompanhe seu peso e evolu√ß√£o ao longo do tempo</div>
      </div>
    </div>
  </div>

  <!-- ================== TREINO: DIAS ================== -->
  <div id="screen1" class="screen">
    <button class="back-top" data-screen="home">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title">Plano de Treino</h1>
      <button id="add-day-btn" class="icon-btn" aria-label="Adicionar dia">+</button>
    </div>

    <div id="days-list" class="progress-list"></div>
  </div>

  <!-- ================== TREINO: EXERC√çCIOS DO DIA ================== -->
  <div id="screenDay" class="screen">
    <button class="back-top" id="back-to-days">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title" id="day-title">Dia</h1>
      <button id="add-ex-btn" class="icon-btn" aria-label="Adicionar exerc√≠cio">+</button>
    </div>

    <div id="ex-list" class="progress-list"></div>
  </div>

  <!-- ================== TREINO: DETALHE DO EXERC√çCIO ================== -->
  <div id="screenExercise" class="screen">
    <button class="back-top" id="back-to-day">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title" id="ex-title">Exerc√≠cio</h1>

      <div class="header-actions">
        <button id="edit-ex-btn" class="edit-btn" aria-label="Editar exerc√≠cio">‚úèÔ∏è</button>
        <button id="delete-ex-btn" class="remove-btn" aria-label="Eliminar exerc√≠cio">√ó</button>
      </div>
    </div>
    
    <!-- HERO (foto/v√≠deo grande) -->
    <div id="ex-hero" class="detail-hero is-hidden">
      <img id="ex-hero-img" alt="Foto do exerc√≠cio" style="display:none;" />
      <video id="ex-hero-video" controls playsinline style="display:none;"></video>
    </div>
    
    <section class="card">
      <div class="card-title">Fotos/V√≠deos</div>
      <input type="file" id="ex-media-input" accept="image/*,video/*" multiple />
      <div id="ex-media-grid" class="media-grid"></div>
    </section>

    <section class="card">
      <div class="card-title">Anota√ß√µes</div>
      <textarea id="ex-notes" rows="3" placeholder="Ex: 3 x 15 Rep"></textarea>
    </section>

    <section class="card">
      <label class="done-row">
        <input type="checkbox" id="ex-done" />
        <span>Marcar como conclu√≠do</span>
      </label>
    </section>
  </div>

  <!-- ================== PLANO ALIMENTAR: TIPOS ================== -->
  <div id="screen2" class="screen">
    <button class="back-top" data-screen="home">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title">Plano Alimentar</h1>
      <button id="add-mealtype-btn" class="icon-btn" aria-label="Adicionar tipo de refei√ß√£o">+</button>
    </div>

    <div id="mealtypes-list" class="progress-list"></div>
  </div>

  <!-- ================== PLANO ALIMENTAR: REFEI√á√ïES DO TIPO ================== -->
  <div id="screenMealType" class="screen">
    <button class="back-top" id="back-to-mealtypes">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title" id="mealtype-title">Tipo</h1>
      <button id="add-meal-btn" class="icon-btn" aria-label="Adicionar refei√ß√£o">+</button>
    </div>

    <div id="meals-list" class="progress-list"></div>
  </div>

  <!-- ================== PLANO ALIMENTAR: DETALHE DA REFEI√á√ÉO ================== -->
  <div id="screenMeal" class="screen">
    <button class="back-top" id="back-to-meals">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title" id="meal-title">Refei√ß√£o</h1>

      <div class="header-actions">
        <button id="edit-meal-btn" class="edit-btn" aria-label="Editar refei√ß√£o">‚úèÔ∏è</button>
        <button id="delete-meal-btn" class="remove-btn" aria-label="Eliminar refei√ß√£o">√ó</button>
      </div>
    </div>
    
    <!-- HERO (foto/v√≠deo grande) -->
    <div id="meal-hero" class="detail-hero is-hidden">
      <img id="meal-hero-img" alt="Foto da refei√ß√£o" style="display:none;" />
      <video id="meal-hero-video" controls playsinline style="display:none;"></video>
    </div>
    
    <section class="card">
      <div class="card-title">Fotos/V√≠deos</div>
      <input type="file" id="meal-media-input" accept="image/*,video/*" multiple />
      <div id="meal-media-grid" class="media-grid"></div>
    </section>

    <section class="card">
      <div class="card-title">Anota√ß√µes</div>
      <textarea id="meal-notes" rows="3" placeholder="Ex: 2 ovos + aveia, 1 iogurte, etc."></textarea>
    </section>
  </div>

  <!-- ================== PROGRESSO ================== -->
  <div id="screen3" class="screen">
    <button class="back-top" data-screen="home">‚Üê <span>Voltar</span></button>

    <div class="progress-header">
      <h1 class="progress-title">Progresso</h1>
      <button id="add-record-btn" class="icon-btn" aria-label="Adicionar registo">+</button>
    </div>

    <!-- ‚úÖ NOVO: TABS no Progresso -->
    <div class="progress-tabs" role="tablist" aria-label="Separadores do Progresso">
      <button type="button" id="tab-progress-records" class="progress-tab active" role="tab" aria-selected="true" aria-controls="progress-panel-records">
        Registos
      </button>
      <button type="button" id="tab-progress-compare" class="progress-tab" role="tab" aria-selected="false" aria-controls="progress-panel-compare">
        Comparar fotos
      </button>
    </div>

    <!-- ‚úÖ Painel 1: Registos -->
    <div id="progress-panel-records" class="progress-panel active" role="tabpanel" aria-labelledby="tab-progress-records">
      <section class="card">
        <div class="card-title">Gr√°fico de Progresso</div>
        <div class="chart-wrap">
          <canvas id="weightChart" width="400" height="150"></canvas>
        </div>
      </section>

      <section class="card">
        <div class="card-title">Resumo</div>
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-label">Peso Inicial</div>
            <div class="summary-value" id="sum-initial">‚Äî</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Peso Atual</div>
            <div class="summary-value" id="sum-current">‚Äî</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Diferen√ßa</div>
            <div class="summary-value" id="sum-diff">‚Äî</div>
          </div>
        </div>
      </section>

      <div class="section-title">Hist√≥rico de Registos</div>
      <div id="progress-list" class="progress-list"></div>
    </div>

    <!-- ‚úÖ Painel 2: Comparar fotos -->
    <div id="progress-panel-compare" class="progress-panel" role="tabpanel" aria-labelledby="tab-progress-compare">
      <section class="card">
        <div class="card-title">Selecionar registos</div>
        <div style="color:#6b7280;font-size:13px;line-height:18px;">
          Seleciona os registos que queres comparar. Cada registo aparece numa linha com 3 colunas fixas:
          <b>Frente</b>, <b>Lado</b>, <b>Costas</b>.
        </div>

        <div style="height:10px"></div>
        <div id="compare-picker-list" class="progress-list"></div>

        <div style="height:10px"></div>
        <div class="form-actions">
          <button type="button" id="compare-clear" class="btn-danger full-width">Limpar sele√ß√£o</button>
          <button type="button" id="compare-apply" class="btn-primary full-width">Comparar</button>
        </div>
      </section>

      <div class="section-title">Compara√ß√£o</div>
      <div id="compare-grid" class="compare-grid"></div>
    </div>
  </div>

  <!-- ================== MODAL: DIA ================== -->
  <div id="modal-day" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="modal-day-title">Novo Dia de Treino</h2>
        <button type="button" class="modal-close" id="close-day-modal">√ó</button>
      </div>
      <p class="modal-sub">Crie um novo dia para organizar os seus exerc√≠cios.</p>
      <input type="text" id="day-name" placeholder="Ex: Segunda-feira, Dia 1, etc." />
      <button type="button" id="save-day" class="btn-primary full-width">Guardar</button>
    </div>
  </div>

  <!-- ================== MODAL: EXERC√çCIO ================== -->
  <div id="modal-ex" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="modal-ex-title">Novo Exerc√≠cio</h2>
        <button type="button" class="modal-close" id="close-ex-modal">√ó</button>
      </div>
      <input type="text" id="ex-name" placeholder="Nome do exerc√≠cio (ex: Agachamento)" />
      <input type="text" id="ex-quick" placeholder="Notas curtas (ex: 3 x 15 Rep)" />
      <button type="button" id="save-ex" class="btn-primary full-width">Guardar</button>
    </div>
  </div>

  <!-- ================== MODAL: TIPO DE REFEI√á√ÉO ================== -->
  <div id="modal-mealtype" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="modal-mealtype-title">Novo Tipo de Refei√ß√£o</h2>
        <button type="button" class="modal-close" id="close-mealtype-modal">√ó</button>
      </div>
      <p class="modal-sub">Crie um tipo (ex: Pequeno-almo√ßo, Almo√ßo, Jantar...).</p>
      <input type="text" id="mealtype-name" placeholder="Ex: Pequeno-almo√ßo" />
      <button type="button" id="save-mealtype" class="btn-primary full-width">Guardar</button>
    </div>
  </div>

  <!-- ================== MODAL: REFEI√á√ÉO ================== -->
  <div id="modal-meal" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="modal-meal-title">Nova Refei√ß√£o</h2>
        <button type="button" class="modal-close" id="close-meal-modal">√ó</button>
      </div>
      <p class="modal-sub">D√™ um t√≠tulo √† refei√ß√£o (ex: ‚ÄúPequeno-almo√ßo 1‚Äù, ‚ÄúAlmo√ßo de domingo‚Äù).</p>
      <input type="text" id="meal-name" placeholder="T√≠tulo da refei√ß√£o" />
      <button type="button" id="save-meal" class="btn-primary full-width">Guardar</button>
    </div>
  </div>

  <!-- ================== MODAL: PROGRESSO ================== -->
  <div id="modal-progress" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="modal-progress-title">Novo Registo</h2>
        <button type="button" class="modal-close" id="close-progress-modal">√ó</button>
      </div>

      <p class="modal-sub">Adicione o seu peso e observa√ß√µes.</p>

      <form id="progress-form">
        <div class="progress-form-row">
          <input type="date" id="date" required />
          <input type="number" id="weight" step="0.1" placeholder="Peso (kg)" required />
        </div>

        <textarea id="notes" rows="4" placeholder="Observa√ß√µes"></textarea>

        <!-- ‚úÖ NOVO: Fotos do Progresso (3 fixas) -->
        <section class="card" style="margin:0;">
          <div class="card-title">Fotos (opcional)</div>
          <div style="color:#6b7280;font-size:13px;line-height:18px;margin-bottom:10px;">
            At√© <b>3 fotos</b> por registo, por ordem fixa: <b>Frente</b>, <b>Lado</b>, <b>Costas</b>.
            Podes adicionar agora ou mais tarde ao editar o registo.
          </div>

          <div class="progress-photos" id="progress-photos">
            <!-- Frente -->
            <div class="progress-photo-slot" data-slot="front">
              <div class="progress-photo-label">Frente</div>
              <input type="file" id="progress-photo-front" accept="image/*" />
              <div class="progress-photo-preview">
                <img id="progress-photo-front-preview" alt="Pr√©-visualiza√ß√£o Frente" style="display:none;" />
                <!-- ‚úÖ NOVO: bot√£o eliminar -->
                <button type="button" class="progress-photo-remove" data-pos="front" aria-label="Eliminar foto da frente">√ó</button>
              </div>
            </div>

            <!-- Lado -->
            <div class="progress-photo-slot" data-slot="side">
              <div class="progress-photo-label">Lado</div>
              <input type="file" id="progress-photo-side" accept="image/*" />
              <div class="progress-photo-preview">
                <img id="progress-photo-side-preview" alt="Pr√©-visualiza√ß√£o Lado" style="display:none;" />
                <!-- ‚úÖ NOVO: bot√£o eliminar -->
                <button type="button" class="progress-photo-remove" data-pos="side" aria-label="Eliminar foto de lado">√ó</button>
              </div>
            </div>

            <!-- Costas -->
            <div class="progress-photo-slot" data-slot="back">
              <div class="progress-photo-label">Costas</div>
              <input type="file" id="progress-photo-back" accept="image/*" />
              <div class="progress-photo-preview">
                <img id="progress-photo-back-preview" alt="Pr√©-visualiza√ß√£o Costas" style="display:none;" />
                <!-- ‚úÖ NOVO: bot√£o eliminar -->
                <button type="button" class="progress-photo-remove" data-pos="back" aria-label="Eliminar foto de costas">√ó</button>
              </div>
            </div>
          </div>

          <!-- A√ß√µes de troca -->
          <div class="progress-photo-actions" style="margin-top:10px; display:flex; gap:10px;">
            <button type="button" id="swap-front" class="btn-primary full-width" aria-label="Trocar foto da frente">Trocar Frente</button>
            <button type="button" id="swap-side" class="btn-primary full-width" aria-label="Trocar foto de lado">Trocar Lado</button>
            <button type="button" id="swap-back" class="btn-primary full-width" aria-label="Trocar foto de costas">Trocar Costas</button>
          </div>
        </section>

        <div class="form-actions" style="margin-top:10px;">
          <button type="submit" class="btn-primary full-width">Guardar</button>
          <button type="button" id="cancel-btn" class="btn-danger full-width">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================== LIGHTBOX (MEDIA) ================== -->
  <div id="lightbox">
    <div class="lightbox-content">
      <button type="button" class="lightbox-close">√ó</button>

      <button type="button" class="lightbox-nav prev" aria-label="Anterior">‚Äπ</button>
      <button type="button" class="lightbox-nav next" aria-label="Seguinte">‚Ä∫</button>

      <h2 id="lightbox-title"></h2>
      <img id="lightbox-img" style="display:none;" />
      <video id="lightbox-video" controls style="display:none;"></video>
      <textarea id="lightbox-notes" placeholder="Notas (opcional para esta foto/v√≠deo)"></textarea>
    </div>
  </div>

  <!-- ================== MENU ‚ãØ (NOVO) ================== -->
  <div id="more-menu" class="more-menu" aria-hidden="true">
    <button type="button" class="more-item" id="open-export">Exportar</button>
    <button type="button" class="more-item" id="open-import">Importar</button>
    <button type="button" class="more-item" id="open-clean">Limpeza</button>
    <button type="button" class="more-item" id="close-more">Fechar</button>
  </div>

  <!-- ================== MODAL: EXPORTAR (NOVO) ================== -->
  <div id="modal-export" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2>Exportar</h2>
        <button type="button" class="modal-close" id="close-export-modal">√ó</button>
      </div>

      <p class="modal-sub">Escolhe o que queres exportar. Vai ser descarregado um ficheiro .json.</p>

      <div class="menu-list">
        <button type="button" class="btn-primary full-width" id="exp-all">Exportar tudo</button>
        <button type="button" class="btn-primary full-width" id="exp-train">S√≥ Treino</button>
        <button type="button" class="btn-primary full-width" id="exp-food">S√≥ Alimenta√ß√£o</button>
        <button type="button" class="btn-primary full-width" id="exp-progress">S√≥ Progresso</button>
      </div>

      <button type="button" class="back-inline" id="back-export">‚Üê Voltar</button>
    </div>
  </div>

  <!-- ================== MODAL: IMPORTAR (NOVO) ================== -->
  <div id="modal-import" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2 id="import-title">Importar</h2>
        <button type="button" class="modal-close" id="close-import-modal">√ó</button>
      </div>

      <!-- STEP 1 -->
      <div id="import-step-1">
        <p class="modal-sub">Escolhe o que queres importar.</p>
        <div class="menu-list">
          <button type="button" class="btn-primary full-width" data-imp-scope="all">Importar tudo</button>
          <button type="button" class="btn-primary full-width" data-imp-scope="train">S√≥ Treino</button>
          <button type="button" class="btn-primary full-width" data-imp-scope="food">S√≥ Alimenta√ß√£o</button>
          <button type="button" class="btn-primary full-width" data-imp-scope="progress">S√≥ Progresso</button>
        </div>
        <button type="button" class="back-inline" id="back-import-1">‚Üê Voltar</button>
      </div>

      <!-- STEP 2 -->
      <div id="import-step-2" style="display:none;">
        <p class="modal-sub">Escolhe o ficheiro .json para importar.</p>

        <input type="file" id="import-file" accept="application/json" />
        <div style="height:10px"></div>

        <button type="button" class="btn-primary full-width" id="go-import-mode" disabled>Continuar</button>
        <button type="button" class="back-inline" id="back-import-2">‚Üê Voltar</button>
      </div>

      <!-- STEP 3 -->
      <div id="import-step-3" style="display:none;">
        <p class="modal-sub">
          Queres <strong>Substituir</strong> o que existe (apaga e mete o do ficheiro)
          ou <strong>Adicionar</strong> (junta ao que j√° tens)?
        </p>

        <div class="menu-list">
          <button type="button" class="btn-danger full-width" id="imp-replace">Substituir</button>
          <button type="button" class="btn-primary full-width" id="imp-add">Adicionar</button>
        </div>

        <button type="button" class="back-inline" id="back-import-3">‚Üê Voltar</button>
      </div>
    </div>
  </div>

  <!-- ================== MODAL: LIMPEZA ================== -->
  <div id="modal-clean" class="modal">
    <div class="modal-card">
      <div class="modal-head">
        <h2>Limpeza</h2>
        <button type="button" class="modal-close" id="close-clean-modal">√ó</button>
      </div>

      <p class="modal-sub">
        Remove fotos/v√≠deos guardados que j√° n√£o est√£o usados em nenhum exerc√≠cio/refei√ß√£o.
      </p>

      <div id="clean-info" class="card" style="margin:0;"></div>

      <div class="menu-list">
        <button type="button" class="btn-danger full-width" id="do-clean">Limpar agora</button>
      </div>

      <button type="button" class="back-inline" id="back-clean">‚Üê Voltar</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>

